<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>إدارة المنتجات</title>
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      padding: 20px;
      background: #fff8dc;
      color: #5a4a00;
    }
    h1 {
      color: #b8860b;
      text-align: center;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    table, th, td {
      border: 1px solid #b8860b;
    }
    th, td {
      padding: 10px;
      text-align: center;
    }
    .btn {
      padding: 5px 10px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .btn-edit {
      background-color: #ffd700;
    }
    .btn-delete {
      background-color: #ff4d4d;
      color: white;
    }
    .btn-add {
      margin: 15px 0;
      background-color: #b8860b;
      color: white;
    }
    input, textarea, select {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
    }
    #form-container {
      margin-bottom: 20px;
      background: #fff;
      padding: 15px;
      border-radius: 6px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>

  <h1>إدارة المنتجات</h1>

  <div id="form-container">
    <h3>إضافة / تعديل منتج</h3>
    <input type="hidden" id="editIndex">
    
    <label>اسم المنتج:</label>
    <input type="text" id="name">
    
    <label>الوصف:</label>
    <textarea id="description"></textarea>
    
    <label>السعر:</label>
    <input type="number" id="price">
    
    <label>القسم:</label>
    <select id="category">
      <option value="">اختر القسم</option>
      <option value="clothes">ملابس</option>
      <option value="accessories">إكسسوارات</option>
      <option value="electronics">إلكترونيات</option>
    </select>
    
    <label>صورة المنتج:</label>
    <input type="file" id="imageFile" accept="image/*" />
    
    <button class="btn btn-add" onclick="saveProduct()">حفظ المنتج</button>
  </div>

  <table id="productTable">
    <thead>
      <tr>
        <th>الاسم</th>
        <th>الوصف</th>
        <th>السعر</th>
        <th>القسم</th>
        <th>صورة</th>
        <th>إجراءات</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    let products = JSON.parse(localStorage.getItem('products')) || [];
    let imageBase64 = "";

    document.getElementById("imageFile").addEventListener("change", function () {
      const file = this.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
          imageBase64 = e.target.result;
        };
        reader.readAsDataURL(file);
      }
    });

    function renderProducts() {
      const tbody = document.querySelector("#productTable tbody");
      tbody.innerHTML = "";
      products.forEach((product, index) => {
        const row = `<tr>
          <td>${product.name}</td>
          <td>${product.description}</td>
          <td>${product.price} د.ك</td>
          <td>${getCategoryName(product.category)}</td>
          <td><img src="${product.image}" width="80"></td>
          <td>
            <button class="btn btn-edit" onclick="editProduct(${index})">تعديل</button>
            <button class="btn btn-delete" onclick="deleteProduct(${index})">حذف</button>
          </td>
        </tr>`;
        tbody.innerHTML += row;
      });
    }

    function getCategoryName(key) {
      switch(key) {
        case "clothes": return "ملابس";
        case "accessories": return "إكسسوارات";
        case "electronics": return "إلكترونيات";
        default: return "";
      }
    }

    function saveProduct() {
      const name = document.getElementById("name").value;
      const description = document.getElementById("description").value;
      const price = document.getElementById("price").value;
      const category = document.getElementById("category").value;
      const index = document.getElementById("editIndex").value;

      if (!name || !description || !price || !category || (!imageBase64 && index === "")) {
        alert("يرجى تعبئة جميع الحقول ورفع صورة");
        return;
      }

      const newProduct = {
        name,
        description,
        price,
        category,
        image: imageBase64 || products[index].image
      };

      if (index === "") {
        products.push(newProduct);
      } else {
        products[index] = newProduct;
        document.getElementById("editIndex").value = "";
      }

      localStorage.setItem("products", JSON.stringify(products));
      renderProducts();
      clearForm();
    }

    function deleteProduct(index) {
      if (confirm("هل أنت متأكد من حذف المنتج؟")) {
        products.splice(index, 1);
        localStorage.setItem("products", JSON.stringify(products));
        renderProducts();
      }
    }

    function editProduct(index) {
      const p = products[index];
      document.getElementById("name").value = p.name;
      document.getElementById("description").value = p.description;
      document.getElementById("price").value = p.price;
      document.getElementById("category").value = p.category;
      document.getElementById("editIndex").value = index;
      imageBase64 = p.image;
    }

    function clearForm() {
      document.getElementById("name").value = "";
      document.getElementById("description").value = "";
      document.getElementById("price").value = "";
      document.getElementById("category").value = "";
      document.getElementById("imageFile").value = "";
      imageBase64 = "";
    }

    renderProducts();
  </script>

</body>
</html>